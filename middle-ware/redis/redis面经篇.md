# Redis面经篇

[TOC]

1. 讲讲Hash的扩容过程

2. Zset底层使用什么数据结构？为什么？

   skiplist，需要支持范围查询。Hash是无序的，不能用；红黑树不支持范围查询，不能用

3. 讲讲Redis过期删除数据的策略

4. 有人说Redis只适合做缓存，不适合做数据库，你怎么看？

5. Redis个别操作特别慢，讲讲排查思路。

   - 内在原因
   
     - **数据结构使用不合理**
   
       - 使用了高复杂度命令，如：`hgetall`，`keys`等
       - 出现了大对象。使用：`redis-cli -a xxxx -d 0 --bigkeys`检测
       - 数据结构编码方式配置不合理。以`hash`为例，手动调整了内部编码格式切换的界限
   
     - **CPU饱和**：使用`redis-cli -a xxxx --stat`查看redis-server的请求处理情况，判断是否超过处理能力边界
   
     - **持久化相关**
   
       - fork阻塞
   
       - AOF刷盘阻塞
   
         > 当硬盘压力过载时，每秒一次的fsync会很慢，造成阻塞
   
       - 写时复制HugePage(2MB)内存页导致阻塞
   
   - 外在原因
   
     - **CPU竞争**
       - 进程竞争：部署问题，将Redis与其他CPU密集型服务部署在一起。不过，使用k8s的话，基本不存在
       - 绑定CPU：绑定CPU可用于降低CPU频繁的上下文切换开销。但是，**如果开启了AOF持久化或参与复制（RDB），将导致子进程和父进程共享CPU，导致出现竞争**
     - **内存交换**：部署问题，开启Swap内存交换

