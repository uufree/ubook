# MongoDB原理篇

[TOC]

## 简介

MongoDB是一个**面向文档**的数据库，具有以下特点：

- 易于使用：无预定义的表，可以按照需求随时在文档中增减字段
- 易于拓展：横向拓展，能自动处理跨集群的数据和负载
- 功能丰富：支持索引、聚合、以及一些特殊的集合类型

## 术语

| **SQL术语/概念** | MongoDB术语/概念 | **解释/说明**                        |
| ---------------- | ---------------- | ------------------------------------ |
| database         | database         | 数据库                               |
| table            | collection       | 数据库表/集合                        |
| row              | document         | 数据记录行/文档                      |
| column           | field            | 数据字段/域                          |
| index            | index            | 索引                                 |
| table joins      |                  | 表连接，MongoDB不支持                |
| primary key      | primary key      | 主键，MongoDB自动将_id字段设置为主键 |

## 基础数据类型

| **数据类型**       | **描述**                                         |
| ------------------ | ------------------------------------------------ |
| String             | 字符串。存储数据常用的数据类型。仅支持UTF-8 编码 |
| Integer            | 整型数值。可分为 32 位或 64 位。                 |
| Boolean            | 布尔值                                           |
| Double             | 双精度浮点值                                     |
| Array              | 用于将数组或列表或多个值存储为一个键             |
| Timestamp          | 时间戳                                           |
| Object             | 用于内嵌文档                                     |
| Null               | 用于创建空值                                     |
| Date               | 日期时间。用 UNIX 时间格式来存储当前日期或时间   |
| Object ID          | 对象 ID。用于创建文档的 ID，类似主键ID           |
| Binary Data        | 二进制数据                                       |
| Regular expression | 正则表达式类型                                   |
|                    |                                                  |
|                    |                                                  |
|                    |                                                  |
|                    |                                                  |

> ObjectID共12字节，其中
>
> - 前 4 个字节表示创建 **unix** 时间戳,格林尼治时间 **UTC** 时间，比北京时间晚了 8 个小时
> - 接下来的 3 个字节是机器标识码
> - 紧接的两个字节由进程 id 组成 PID
> - 最后三个字节是随机数

## 文档

### 填充因子

移动文档是一个非常慢的操作，MongoDB需要先将文档原先所占的空间释放掉，再将文档移动到另外一个位置。可以通过`db.coll-name.stat()`查询集合的填充因子。**当文档增长无法避免时，可以考虑采用范式化设计文档结构**。

![image-20211118125016154](assets/image-20211118125016154.png)

### 范式与反范式

可根据以下特征，进行表设计：

![image-20211118194552790](assets/image-20211118194552790.png)